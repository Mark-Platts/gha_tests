name: Update 3d_4d_shape_render in portfolio

on: workflow_dispatch

permissions:
  contents: write

jobs:
  update-app:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout the portfolio repository
      - name: Checkout portfolio
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      # 2. Prepare working directories
      - name: Create temp and build folders
        run: |
          mkdir temp
          mkdir -p build/apps/3d_4d_shape_render

      # 3. Checkout 3d_4d_shape_render repo into temp
      - name: Checkout 3d_4d_shape_render repo
        uses: actions/checkout@v4
        with:
          repository: Mark-Platts/3D-4D-Render-Engine
          path: temp/3d_4d_shape_render
          fetch-depth: 1

      # 4. Copy portfolio root files â†’ build/ (excluding unwanted folders)
      - name: Copy portfolio files into build
        run: |
          rsync -av \
            --exclude='.git' \
            --exclude='.github' \
            --exclude='build' \
            --exclude='temp' \
            ./ build/

      # 5. Copy 3d_4d_shape_render files into build/apps/3d_4d_shape_render
      - name: Copy cpusim into apps folder
        run: |
          rsync -av \
            --exclude='.git' \
            --exclude='.github' \
            temp/3d_4d_shape_render/ build/apps/3d_4d_shape_render/

      # 6. Deploy build/ folder to the deploy branch
      - name: Deploy build/ to gh-pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./build
          publish_branch: gh-pages
  
